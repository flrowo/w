<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    :root{
        --note-border-size: 2px;

        /* TRANSPARENT STYLE
        --red-note-border-color: rgba(255, 0, 0, 0.8);
        --blue-note-border-color: rgba(0, 110, 255, 0.8);
        --red-note-bg-color: rgba(255, 0, 0, 0.7);
        --blue-note-bg-color: rgba(0, 110, 255, 0.7); */

        --red-note-border-color: white;
        --blue-note-border-color: white;
        --red-note-bg-color: rgba(255, 0, 0, 0.8);
        --blue-note-bg-color: rgba(0, 110, 255, 0.8);

        --hit-don: rgb(255, 30, 0);
        --hit-katsu: rgb(0, 136, 255);
    }
    *{
        margin: 0;
        overflow: hidden;
        user-select: none;
    }


    
    /* GENERAL */
    html, body{
        height: 100%;
        width: 100%;
        background-color: black;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 12px;
        overflow: visible;
        
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
    }
    #content{
        position: relative;
        width: 500px;
        height: 400px;
        display: flex;
        flex-wrap: wrap;
        align-content: center;
        background-color: black;
        border: solid 1px white;
    }



    /* MAIN SCREEN */
    #main-screen{
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: rgb(67, 61, 76);
        z-index: 110000;
    }.main-screen-element{
        width: 100%;
        height: auto;
    }#main-screen-main{
        overflow: visible;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        perspective: 500px;
        flex-grow: 1;
        animation: main-screen-main 1s infinite;
    }@keyframes main-screen-main{
        0%{ background-color: 1; }
        50%{ scale: 1.01; }
        100%{ scale: 1; }
    }
    #main-screen-header{
        background-color: #00000030;
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        height: 10%;
    }#username-space{
        margin-left: 15px;
        color:white;
    }#username-label{
        font-weight: bold;
    }#music-player{
        margin-right: 5px;
        height: 100%;
        display: flex;
        flex-wrap: wrap;
        flex-direction: column;
        justify-content: center;
        align-items: flex-end;
    }#now-playing-name{
        color: white;
        height: 16px;
    }#music-player-buttons{
        height: 20px;
        width: 100px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
        align-items: center;
    }.music-player-button{
        height: 16px;
        margin: 2px;
        background-repeat: no-repeat;
        background-size: contain;
        background-position: center;
        flex-grow: 1;
        cursor: pointer;
        transition: 100ms cubic-bezier(0.4, 0, 0.2, 1);
    }.music-player-button:hover{
        scale: 1.2;
    }.main-screen-option{
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        align-content: flex-start;
        margin: 5px 0;
        width: 70%;
        height: 20%;
        border: solid 1px white;
        color: white;
        cursor: pointer;
        font-size: 70px;
        transition: 100ms;
        mix-blend-mode: lighten;
        background-color: rgba(169, 56, 97, 0.492);
    }.main-screen-option:hover{
        scale: 1.1;
        background-color: rgb(169, 56, 97);
    }
    #main-screen-footer{
        height: 10%;
        background-color: #00000030;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        color: white;
    }#main-screen-footer div{
        padding: 5px;
        transition: 200ms;
    }#main-screen-footer div:hover{
        scale: 1.1;
        color: rgb(255, 206, 175);
    }
    
    

    /* PLAYFIELD */
    #playfield{
        border: solid 1px red;
        box-sizing: border-box;
        width: 100%;
        height: 20%;
        display: flex;
        flex-wrap: wrap;
        align-content: center;
        align-items: center;
    }

    .cursor{
	    width: 55px;
        height: 55px;
        border: solid 1px rgba(255, 255, 255, 0.3);
        background-color: rgba(255, 255, 255, 0.2);
        position: absolute;
        left: 120px;
    }

    .key-overlay{
        width: 60px;
        height: 60px;
        position: absolute;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-content: center;
        left: 10px;
        border: solid 1px #FFF;
        box-sizing: border-box;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 100000;
    }.key-light{
        margin: 1px;
        width: 10px;
        height: 10px;
        background-color: rgb(0, 255, 0);
        visibility: hidden;
    }.key-don{
        background-color: var(--hit-don);
    }.key-katsu{
        background-color: var(--hit-katsu);
    }.key-active{
        visibility: visible;
    }

    .feedback{
        width: 10px;
        height: 10px;
        position: absolute;
        top: 140px;
        left: 104px;
        opacity: 0.8;
    }
    .feedback_miss{
        background-color: #F00;
    }.feedback_fifty{
        background-color: #FF0;
    }.feedback_hundred{
        background-color: transparent;
    }

    /* NOTES */
    #notes{
        border: solid 1px yellow;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
    }
    .note{
        --note-size: 50px;
        width: var(--note-size);
        height: var(--note-size);
        position: absolute;
        border-radius: 50%;
        border-style: solid;
        border-width: var(--note-border-size);
        transform: translate(-50%, 0);
    }.don{
        border-color: var(--red-note-border-color);
        background-color: var(--red-note-bg-color);
    }.katsu{
        border-color: var(--blue-note-border-color);
        background-color: var(--blue-note-bg-color);
    }



    /* MENU */
    #menu{
        position: absolute;
        left: -50%;
        height: 100%;
        width: 50%;
        background-color: rgba(0, 0, 0, 0.5);
        border: solid 1px rgb(255, 0, 0);
        box-sizing: border-box;
        overflow: auto;

        display: flex;
        flex-wrap: wrap;
        align-items: start;
        justify-content: center;

        color: white;
        z-index: 110001;

        transition: all 300ms;
        opacity: 0;
    }.menu-topic{
        width:100%;
        padding: 5px;
        margin: 5px;
        display: flex;
        flex-wrap: wrap;
        align-items: start;
        justify-content: center;
        flex-direction: column;

        background-color: rgba(112, 112, 112, 0.5);
        border: solid 1px rgb(255, 126, 126);
        box-sizing: border-box;
    }.menu-element{
        padding: 5px;
        margin-top: 5px;
        width: 100%;
        display: flex;
        flex-wrap: wrap;
        align-items: start;
        justify-content: center;
        flex-direction: column;

        background-color: rgba(112, 112, 112, 0.5);
        border: solid 1px rgb(255, 126, 126);
        box-sizing: border-box;
    }
    .menu-field{
        display: flex;
        align-items: center;
        width: 100%;
        margin-top: 5px;
    }.menu-field input{
        flex-grow: 1;
    }.input-text{
        border: solid 1px black;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        width: 80%;
    }
    .menu-field output{
        min-width: 20%;
        text-align: right;
    }
    .menu-button{
        margin-top: 5px;
        padding: 5px;
        align-self: flex-end;
        cursor: pointer;
        background-color: rgb(220, 220, 220);
        color: black;
        border-radius: 5px;
        user-select: none;
    }.back-button{
        position: absolute;
        bottom: 5px;
        left: 6px;
        background-color: rgb(255, 100, 100);
        z-index: 110002;
        font-weight: bold;
        color: white;
        
        opacity: 0.8;
        transition: 100ms;
        animation: button-float 1s linear;
        animation-iteration-count: infinite;
    }@keyframes button-float {
        0% { bottom: 5px; }
        50% { bottom: 8px; }
        100% { bottom: 5px; }
    }
    .back-button:hover{
        scale: 1.1;
        opacity: 1;
    }.back-button-disabled{
        display: none;
    }.options-slider{
        appearance: none;

        outline: none;
        opacity: 0.8;
        background-color: rgb(0,0,0, 0.5);
        height: 10px;
        border-radius: 1px;

        transition: 100ms;
    }.options-slider:hover{
        opacity: 1;
    }.options-slider::-webkit-slider-thumb{
        appearance: none;
        height: 10px;
        width: 10px;
        border-radius: 1px;
        background-color: rgb(255, 100, 100);
    }.options-slider::-moz-range-thumb{
        height: 10px;
        width: 10px;
        border-radius: 1px;
        background-color: rgb(255, 100, 100);
    }

    /* SPECIFIC MENU ELEMENTS */
    #mapText{
        background-color: rgba(0, 0, 0, 0.5);
        border: solid 1px black;
        color: white;
        height: 30px;
        width: 80%;
        resize: none;
    }



    /* OTHER */
    .disabled{
        display: none !important;
    }
</style>
<body>

    <div id="content">
        <div id="main-screen">
            <div id="main-screen-header" class="main-screen-element">
                <div id="username-space">
                    <div style="display: flex; flex-wrap: wrap; align-content: center; height:100%;">
                        Hello,&nbsp;<div id="username-label">PLACEHOLDER</div>!
                    </div>
                </div>
                <div id="music-player">
                    <div id="now-playing-name">now playing nameeee eeeeeee</div>
                    <div id="music-player-buttons">
                        <div class="music-player-button play" style="background-image: url('img/play_img.png');" onclick="gc.playSong()"></div>
                        <div class="music-player-button pause" style="background-image: url('img/pause_img.png');" onclick="gc.pauseSong()"></div>
                        <div class="music-player-button stop" style="background-image: url('img/stop_img.png');" onclick="gc.stopSong()"></div>
                        <div class="music-player-button previous" style="background-image: url('img/previous_img.png');" onclick="gc.playPreviousSong()"></div>
                        <div class="music-player-button next" style="background-image: url('img/next_img.png');" onclick="gc.playNextSong()"></div>
                    </div>
                </div>
            </div>
            <div id="main-screen-main" class="main-screen-element">
                <div class="main-screen-option" onclick="gc.exitGame();" style="transform: rotate3d(-0.4, 1, 0, -45deg) translate3d(27px, 0px, -40px); order: 2; width: 50%;">EXIT</div>
                <div class="main-screen-option" onclick="gc.openMenu();" style="transform: rotate3d(1.5, -3, 0, 30deg) translate3d(0px, 15px, 0px); order: 1;">OPTIONS</div>
                <div class="main-screen-option" onclick="gc.goToBeatmapSelect();" style="transform: rotate3d(0.1, 1, 0, 35deg) translate3d(0px, 19px, 0px); order: 0; justify-content: flex-start; font-weight: bold;">PLAY</div>
            </div>
            <div id="main-screen-footer" class="main-screen-element">
                taiko game by<div style="cursor: pointer;" onclick="window.open('https://flrowo.github.io/w/', '_blank');"><b>flrowo</b></div>
            </div>
        </div>
        <div id="beatmap-select" class="disabled">

        </div>

        <div id="playfield" class="disabled">
            <div class="key-overlay">
                <div id="key-light-left-k" class="key-light key-katsu key-left"></div>
                <div id="key-light-left-d" class="key-light key-don key-left"></div>
                <div id="key-light-right-d" class="key-light key-don key-right"></div>
                <div id="key-light-right-k" class="key-light key-katsu key-right"></div>
            </div>
            <div id="cursor" class="note cursor"></div>
            <div id="notes"></div>
        </div>
        <div id="results-screen" class="disabled">

        </div>

        <div class="menu-button back-button back-button-disabled" onclick="gc.closeMenu();">BACK</div>
        <div id="menu">

            <div class="menu-topic">
                <h1>GENERAL</h1>
                <div class="menu-element">
                    <p class="label">Change your username:</p>
                    <input id="username-input" onblur="gc.changeUsername();" type="text" class="menu-field input-text" placeholder="PLACEHOLDER">
                </div>
            </div>

            <div class="menu-topic">
                <h1>TESTING</h1>
                <div class="menu-element">
                    <p class="label">paste .osu [HitNotes] text here:</p>
                    <textarea id="mapText" class="menu-field"></textarea>
                    <div class="menu-button" onclick="convertMap();">CONVERT</div>
                </div>
            </div>

            <div class="menu-topic">
                <h1>AUDIO</h1>
                <div class="menu-element">
                    <p class="label">Master volume</p>
                    <div class="menu-field">
                        <input id="master-volume" class="options-slider" type="range" min="0" max="100" value="30"
                        oninput="gc.changeMasterVolume(); this.nextElementSibling.value = `${this.value}%`;">
                        <output></output>
                    </div>
                </div>
                <div class="menu-element">
                    <p class="label">Music volume</p>
                    <div class="menu-field">
                        <input id="music-volume" class="options-slider" type="range" min="0" max="100" value="30"
                        oninput="gc.changeMusicVolume(); this.nextElementSibling.value = `${this.value}%`;">
                        <output></output>
                    </div>
                    
                </div>
                <div class="menu-element">
                    <p class="label">Effects volume</p>
                    <div class="menu-field">
                        <input id="effects-volume" class="options-slider" type="range" min="0" max="100" value="30"
                        oninput="gc.changeEffectsVolume(); this.nextElementSibling.value = `${this.value}%`;">
                        <output></output>
                    </div>
                </div>
            </div>

            <div class="menu-topic" style="display: flex; flex-direction: column; flex-wrap: wrap; align-items: center; margin-bottom: 35px;">
                <div style="width: 100%; text-align: center; font-size: 20px;">
                    <b>taiko game</b><br>
                    created by flrowo
                </div>
                <div style="font-size: 8px; margin-top: 8px; width: 100%; text-align: center;">
                    made for google chrome<br>
                    version alpha-0.1
                </div>
            </div>

        </div>
    </div>
    <script src="base64database.js"></script>
    <script>

        // OTHER
        let elapsedMs = 0;
        function getElapsedMs() {
            let timeNow = new Date().getTime();
            return (timeNow - mapOriginMs - globalNoteOffsetMs);
        }
        
        
        
        function hitNextNote(isDon) {
            let r = 0;
            let noteToHit = new Note();

            for (let i = 0; i < notesArray.length; i++) {
                let note = notesArray[i];
                if(!note.disabled){
                    noteToHit = note;
                    break;
                }
            }
            noteToHit.hit(isDon);

            return r;
        }

        

        // CLASSES
 
        // KEY CLASS
        const KeyClass = class{
            #id;
            #letter;
            #isDon;
            #htmlElement;
            #isPressable;
            #lightDurationMs;
            #timePressed;
            constructor(id, letter, isDon, htmlElement) {
                this.#id = id;
                this.#letter = letter;
                this.#isDon = isDon;
                this.#htmlElement = htmlElement;

                this.#isPressable = true;
                this.#lightDurationMs = 100;
                this.#timePressed = 0;
            }
            // LIGHT TIMER
            resetTimer(){ this.#timePressed = new Date().getTime(); }
            checkTimer(){
                let percentage = this.clickTimeElapsedMs()/this.#lightDurationMs;

                if(percentage < 1) {
                    if(!this.#htmlElement.classList.contains("key-active")) {
                        this.#htmlElement.classList.add("key-active");
                    }
                }
                else if(this.#htmlElement.classList.contains("key-active")){
                    this.#htmlElement.classList.remove("key-active");
                }
            }
            clickTimeElapsedMs(){
                return new Date().getTime() - this.#timePressed;
            }
            
            // id
            getId(){ return this.#id; }

            // isDon
            checkIfIsDon(){ return this.#isDon; }

            // htmlElement
            getHtmlElement(){ return this.#htmlElement; }

            // isPressable
            checkIfIsPressable(){ return this.#isPressable }
            setPressable(){ this.#isPressable = true; }
            setUnPressable(){ this.#isPressable = false; }

            // press
            press(){
                if(!this.checkIfIsPressable()) return;
                if(this.checkIfIsDon()){
                    hitNextNote(true);
                    hitNormal.play();
                } else {
                    hitNextNote(false);
                    hitClap.play();
                } 
                this.resetTimer();
                this.setUnPressable();
            }
        }

        // FEEDBACK CLASS
        const Feedback = class{
            static count = 0;
            #id; #feedbackNumber;
            // type: miss => 0; 50% => 1; 100% => 2
            constructor(type){
                this.#id = "feedback"+(++this.constructor.count);
                this.#feedbackNumber = "feedback_miss";
                if(type == 3){ this.#feedbackNumber = "feedback_miss" }
                else if(type == 2){ this.#feedbackNumber = "feedback_fifty" }
                else if(type == 1){ this.#feedbackNumber = "feedback_hundred" }

                this.#create();
                this.#position();

                this.#countdownDelete();
            }

            #create(){
                let feedbackDiv = document.createElement("div");
                feedbackDiv.classList.add("feedback");
                feedbackDiv.classList.add(this.#feedbackNumber);
                feedbackDiv.id = this.#id;
                document.getElementById("playfield").appendChild(feedbackDiv);
            }

            #position(){
                let instanceDiv = document.getElementById(this.#id);
                let top = window.getComputedStyle(instanceDiv).getPropertyValue("top");
                let left = window.getComputedStyle(instanceDiv).getPropertyValue("left");
                let randomLength = instanceDiv.offsetWidth;
                instanceDiv.style.top = parseInt(top) + (Math.random()*randomLength - randomLength/2)/5 + "px";
                instanceDiv.style.left = parseInt(left) + (Math.random()*randomLength - randomLength/2) + "px";
            }

            #countdownDelete(){
                let feedbackDuration = setInterval(()=>{
                    document.getElementById(this.#id).remove();
                    clearInterval(feedbackDuration);
                }, 500);
            }
        }

        // NOTE CLASS
        class Note{
            static count = 0;
            
            disabled; isNext; // other properties

            #durationMs; #type; #sv; #bpm; #volume; // constructor generated properties

            #id; #divZIndex; #zeroPositionPx; #totalLengthPx; // predefined properties

            constructor(type, sv, bpm, offset, volume){
                // set properties
                this.#type = type;
                this.#sv = sv;
                this.#bpm = bpm;
                this.#durationMs = offset;
                this.#volume = volume;

                this.disabled = false;
                this.#id = `note${this.constructor.count}`;
                this.#divZIndex = this.constructor.count;
                let svMultiplier = this.#sv*this.#bpm/300; // divided by 300 for note spacing
                this.#zeroPositionPx = 0; // cursor position offset
                this.#totalLengthPx = this.#durationMs*svMultiplier;

                this.constructor.count++;
            }

            create(){
                // create instance in HTML
                let noteDiv = document.createElement("div");
                // div id
                noteDiv.id = this.#id;
                // div classes
                noteDiv.classList.add("circle");
                noteDiv.classList.add("note");
                noteDiv.classList.add(this.getType());
                // z-index
                noteDiv.style.zIndex = 99999 - this.#divZIndex; // 99999 should be changed to a "length of notes" variable
                document.getElementById("notes").appendChild(noteDiv);

                // set initial position
                this.#setPosition(this.#totalLengthPx);
            }
            
            move() {
                if(this.disabled) return;

                let percentage = getElapsedMs()/this.#durationMs;
                let lengthPx = this.#totalLengthPx;

                let posPx = lengthPx - (lengthPx*percentage) + this.#zeroPositionPx;
                this.#setPosition(posPx);
                
                let hitErrorMs = getElapsedMs() - this.#durationMs;
                if(hitErrorMs > ODinMs50) {
                    this.#setPosition(this.#zeroPositionPx);
                    new Feedback(0);
                    this.#setDisabled();
                }
            }

            hit(isDon){
                let hitErrorMs = getElapsedMs() - this.#durationMs;

                let feedbackColor = "black";
                let feedbackNumber = 0;
                let isHitColorRight;

                if(this.getIsDon() != isDon){
                    isHitColorRight = false;
                } else isHitColorRight = true;

                // SET FEEDBACK

                // HIT 100% (GREAT)
                if(isHitColorRight && (hitErrorMs <= ODinMs100 && hitErrorMs >= -ODinMs100)) {
                    feedbackColor = "white";
                    feedbackNumber = 1;
                }

                // HIT 50% (OK)
                else if(isHitColorRight && (hitErrorMs <= ODinMs50 && hitErrorMs >= -ODinMs50) ) {
                    feedbackColor = "green";
                    feedbackNumber = 2;
                }

                // MISS
                else if (hitErrorMs <= ODinMsMiss && hitErrorMs >= -ODinMsMiss) {
                    feedbackColor = "red";
                    feedbackNumber = 3;
                }
                
                // CREATE FEEDBACK
                if(feedbackNumber != 0) {
                    console.log("%chitErrorMs: "+hitErrorMs+" ms", "color: "+feedbackColor+";");
                    new Feedback(feedbackNumber);
                    this.#setDisabled();
                }
            }

            #setPosition(pos){
                pos = pos + globalOffsetPx;
                document.getElementById(this.#id).style.left = `${pos}px`;
            }

            #setDisabled(){ this.disabled = true; document.getElementById(this.#id).remove(); }
            
            getId(){ return this.#id; }
            getSV(){ return this.#sv; }
            getType(){ return (this.#type == 0 ? "don" : "katsu"); }
            getIsDon(){ return (this.#type == 0 ? true : false); }
            getOffset(){ return this.#durationMs; }
        }

        // HIT AUDIO CLASS
        class HitAudio{
            #audioArray;

            constructor(audioBase64){
                this.#audioArray = [];
                let length = 20;

                for (let i = 0; i < length; i++) {
                    let tempAudio = new Audio(audioBase64);
                    this.#audioArray.push(tempAudio);
                }
            }

            play(){
                for (let i = 0; i < 10; i++) {
                    if(this.#audioArray[i].paused) {
                        this.#audioArray[i].play();
                        break;
                    }
                }
            }

            changeVolume(volume){
                this.#audioArray.forEach(audio => {
                    audio.volume = volume;
                });
            }
        }

        // BEATMAP CLASS
        class Beatmap{
            static counter = 0;
            index;

            // GENERAL
            #audioReferenceString;
            previewTime;
            mode;

            // METADATA
            title;
            titleUnicode;
            artist;
            artistUnicode;
            creator;
            diffName;
            source;
            tags;
            beatmapId;
            beatmapSetId;

            // DIFFICULTY
            hp;
            od;
            sliderMultiplier;
            sliderTickRate;

            // EVENTS
            bgReferenceString;
            
            // HIT OBJECTS
            noteArray;

            constructor(
                audio, previewTime, mode,
                title, titleUnicode, artist, artistUnicode, creator, diffName, source, tags, beatmapId, beatmapSetId,
                hp, od, sliderMultiplier, sliderTickRate,
                bg,
                noteArray )
            {
                // GENERAL
                this.#audioReferenceString = audio;
                this.previewTime = previewTime;
                this.mode = mode;

                // METADATA
                this.title = title;
                this.titleUnicode = titleUnicode;
                this.artist = artist;
                this.artistUnicode = artistUnicode;
                this.creator = creator;
                this.diffName = diffName;
                this.source = source;
                this.tags = tags;
                this.beatmapId = beatmapId;
                this.beatmapSetId = beatmapSetId;

                // DIFFICULTY
                this.hp = hp;
                this.od = od;
                this.sliderMultiplier = sliderMultiplier;
                this.sliderTickRate = sliderTickRate;

                // EVENTS
                this.bgReferenceString = bg;

                // HIT OBJECTS
                this.noteArray = noteArray;

                this.index = this.constructor.counter++;
            }
            
            getAudio(){
                return this.#audioReferenceString;
            }

            getTitle(isUnicode = true){
                let r;
                if(isUnicode) r = this.titleUnicode;
                else this.title;
                return r;
            }

            getArtist(isUnicode = true){
                let r;
                if(isUnicode) r = this.artistUnicode;
                else this.artist;
                return r;
            }
        }

        // GAME CONTROLLER CLASS
        class GameController{
            // GAME SETTINGS (OBJECTS)
            #username;

            #globalOffsetPx; // maybe delete latter!!
            #globalNoteOffsetMs; // offset like osu! "+" is more to right and "-" is more to left
            #globalHitOffsetMs; // you can't change this in osu!
            #targetFps;

            #masterVolume;
            #musicVolume;
            #effectsVolume;

            #useUnicode;

            
            // ----- OBJECTS -----
            #audioElement;
            #menuElement;
            #backButtonElement1;
            #cursorOffsetPx;
            #frameLength;



            // ----- RUNTIME VARIABLES -----
            // GAMEPLAY INSTANCES
            #mapOriginMs;
            #instOd;
            #odInstInMs100; 
            #odInstInMs50;
            #odInstInMsMiss;

            // STATE VARIABLES
            #isBackButtonEnabled;
            #stopFixedUpdate;

            #isGameplay;
            #isGameplayPaused;
            #isMainScreen;

            #isMenuOpen;
            #pressedLetterO;
            #pressedCtrl;
            
            #playingNowBeatmapIndex;
            #beatmapPlaylist;


            // ~~~~~ OTHER ~~~~~
            // ----- AUDIO -----
            // MUSIC PLAYER
            #beatmapArray;
            // HIT KEYS
            #hitNormal;
            #hitClap;
            
            // ~ KEY EVENTS ~
            #keyArray;

            constructor(){
                //localStorage.clear();
                this.start();

                // SET BEATMAP LIST and set first beatmap selected
                // hit objects
                let tempBeatmapArray = [
                    new Beatmap(base64database.mochio.audio, 16609, 1, "Mochio-", "モチオー", "[Kyoro]", "【Kyoro】", "Maimaing", "Outer Oni", "スーパーマリオRPG", "音MAD oto-mad otomad", 3734413, 1819949, 7, 7, 1.4, 1, base64database.mochio.bg, [new Note(0, 1, 200, 1000, 1), new Note(0, 1, 200, 1500, 1), new Note(2, 1, 200, 2000, 1)]),
                    new Beatmap(base64database.afroknuckle.audio, -1, 1, "AFRO KNUCKLE", "AFRO KNUCKLE", "Nekomata Master+", "猫叉Master+", "femboy mapper", "Samba Oni", "beatmania IIDX 22 PENDUAL", "Naoyuki Sato AFRO-SAMBA instrumental", 2880034, 1395286, 5, 6.5, 1.4, 1, base64database.afroknuckle.bg, [new Note(0, 1, 200, 1000, 1), new Note(0, 1, 200, 1500, 1), new Note(2, 1, 200, 2000, 1)]),
                    
                ];
                this.#beatmapArray = tempBeatmapArray.slice(0);
                this.#beatmapPlaylist = [];
                while(tempBeatmapArray.length > 0){
                    let randomNumber = Math.floor(Math.random()*tempBeatmapArray.length);

                    this.#beatmapPlaylist.push(tempBeatmapArray[randomNumber]);
                    tempBeatmapArray.splice(randomNumber, 1);
                }

                this.setBeatmap(this.#beatmapPlaylist[0].index);
                
                this.goToMainScreen();
                this.playSong();
                this.#audioElement.addEventListener("ended",()=>{
                    if(this.#isMainScreen){
                        this.playNextSong();
                    } else if(!this.#isGameplay){
                        this.playSong();
                    }
                });
            }

            start() {
                console.log("start();");
                
                // HIT KEY SOUND EFFECTS
                this.#hitNormal = new HitAudio(base64database.hitKeys.hitNormalString);
                this.#hitClap = new HitAudio(base64database.hitKeys.hitClapString);

                // load user settings from localStorage or use defaults
                this.loadSettings();

                // initialize class properties and objects
                this.#audioElement = new Audio();
                this.#menuElement = document.getElementById("menu");
                this.#backButtonElement1 = document.getElementsByClassName("back-button")[0];
                
                this.#cursorOffsetPx = parseInt(getComputedStyle(document.getElementById("cursor")).getPropertyValue("left"));
                this.#frameLength = 1000/this.#targetFps;
                
                this.#isBackButtonEnabled = false;
                this.#stopFixedUpdate = false;

                this.#isGameplay = false;
                this.#isGameplayPaused = false;
                this.#isMainScreen = false;

                this.#isMenuOpen = false;
                this.#pressedLetterO = false;
                this.#pressedCtrl = false;

                this.#playingNowBeatmapIndex = 0;
                this.#beatmapPlaylist = null;
                
                // set and save to localStorage
                this.setSettings();
                this.saveSettings();

                // initialize inputs and remaining commands
                this.initializeStructures();
            }

            fixedUpdate() {
                
                let moved = false;

                // note update
                notesArray.forEach(note => {
                    if(!note.disabled) {
                        note.move();
                        moved = true;
                    }
                });

                // key update
                for (let i = 0; i < KeyArray.length; i++) {
                    KeyArray[i].checkTimer();
                }
                
                // exit loop check
                if(!moved && !this.#stopFixedUpdate) {
                    console.log("execution time: "+(new Date().getTime() - mapOriginMs+"\nlast note offset: "+notesArray[notesArray.length-1].getOffset()))
                    stopFixedUpdate = true;
                    this.#isGameplay = false;
                    this.goToResultsScreen();
                }
                setTimeout(this.fixedUpdate, frameLength);
            }

            loadSettings(){
                
                // ----- GAME SETTINGS -----
                this.#username = new GameSetting("username");

                // GAMEPLAY
                this.#globalOffsetPx = new GameSetting("globalOffsetPx");
                this.#globalNoteOffsetMs = new GameSetting("globalNoteOffsetMs");
                this.#globalHitOffsetMs = new GameSetting("globalHitOffsetMs");
                this.#targetFps = new GameSetting("targetFps");

                // LANGUAGE
                this.#useUnicode = new GameSetting("useUnicode");

                // AUDIO
                this.#masterVolume = new GameSetting("masterVolume");
                this.#musicVolume = new GameSetting("musicVolume");
                this.#effectsVolume = new GameSetting("effectsVolume");
            }

            saveSettings(){
                // maybe after done: if(dont_save == true) return;
                
                // AUDIO
                this.#masterVolume.saveValue();
                this.#musicVolume.saveValue();
                this.#effectsVolume.saveValue();
            }

            setSettings(){
                document.getElementById("username-label").innerHTML = this.#username.value;
                document.getElementById("username-input").value = this.#username.value;

                // AUDIO
                document.getElementById("master-volume").value = this.#masterVolume.value*100;
                document.getElementById("master-volume").nextElementSibling.value = `${this.#masterVolume.value*100}%`;
                document.getElementById("music-volume").value = this.#musicVolume.value*100;
                document.getElementById("music-volume").nextElementSibling.value = `${this.#musicVolume.value*100}%`;
                document.getElementById("effects-volume").value = this.#effectsVolume.value*100;
                document.getElementById("effects-volume").nextElementSibling.value = `${this.#effectsVolume.value*100}%`;

                this.setVolume();
            }
            
            // INITIALIZATION
            initializeStructures(){
                
                // KEY EVENTS
                this.#keyArray = localStorage.getItem("keyArray") || [
                    new KeyClass(68, "D", false, document.getElementById("key-light-left-k")),
                    new KeyClass(70, "F", true, document.getElementById("key-light-left-d")),
                    new KeyClass(74, "J", true, document.getElementById("key-light-right-d")),
                    new KeyClass(75, "K", false, document.getElementById("key-light-right-k")),
                ];
                document.onkeydown = (e)=>{
                    if(this.#isGameplay){
                        // HIT KEYS DFJK
                        this.#keyArray.forEach(key => {
                            if(e.keyCode == key.getId()) key.press();
                        });
                    }

                    // ESCAPE
                    if(e.keyCode === 27){
                        // close menu if open
                        if(this.#isMenuOpen){ this.closeMenu(); }
                    }

                    // open/close menu with "ctrl+o"
                    if(e.keyCode == 17){ this.#pressedLetterO = true; }
                    if(e.keyCode == 79){ this.#pressedCtrl = true; }

                    if(this.#pressedLetterO && this.#pressedCtrl){
                        if(this.#isMenuOpen){
                            this.closeMenu();
                        } else {
                            this.openMenu();
                        }
                        // disable browser opening file
                        event.cancelBubble = true;
                        return false;
                    }
                };
                document.onkeyup = (e)=>{

                    // hit keys
                    for (let i = 0; i < this.#keyArray.length; i++) {
                        if(e.keyCode == this.#keyArray[i].getId()){
                            this.#keyArray[i].setPressable();
                        }
                    }

                    // open/close menu with "ctrl+o"
                    if(e.keyCode == 17){ this.#pressedLetterO = false; }
                    if(e.keyCode == 79){ this.#pressedCtrl = false; }
                };
            }

            
            
            // GAMEPLAY INSTANCE
            playBeatmap(){
                // prepare to play / load beatmap
                this.stopSong();

                // set useful variables
                this.#mapOriginMs = new Date().getTime();

                // set map properties
                let tempBeatmap = this.getBeatmapPlayingNow();
                this.#instOd = tempBeatmap.od;
                this.calculateODinMs();

                // create notes
                tempBeatmap.noteArray.forEach(note => {
                    note.create();
                });
                // play song
                this.playSong();

                this.#isGameplay = true;
                fixedUpdate();
            }
            calculateODinMs(){
                // https://osu.ppy.sh/wiki/en/Beatmap/Overall_difficulty
                let od = this.#instOd;
                this.#odInstInMs100 = od <= 5 ? (35 - (35 - 50) * (5 - od) / 5) : (35 + (20 - 35) * (od - 5) / 5);
                this.#odInstInMs50 = od <= 5 ? (80 - (80 - 120) * (5 - od) / 5) : (80 + (50 - 80) * (od - 5) / 5);
                this.#odInstInMsMiss = od <= 5 ? (95 - (95 - 135) * (5 - od) / 5) : (95 - (95 - 135) * (5 - od) / 5);
                console.log("#ODinMs100: "+this.#odInstInMs100+" || #ODinMs50: "+this.#odInstInMs50+" || #ODinMsMiss: "+this.#odInstInMsMiss);
            }



            // OBJECTS
            setBeatmap(index, goToPreviewTime = 0){
                let tempBeatmap = this.findBeatmapByIndex(index);
                
                this.#audioElement.src = tempBeatmap.getAudio();
                this.#audioElement.load();
                if(goToPreviewTime == 1){
                    let previewTime = tempBeatmap.previewTime;
                    if(previewTime < 0) previewTime = 0;
                    this.#audioElement.currentTime = previewTime/1000;
                }
                document.getElementById("now-playing-name").innerHTML = `${tempBeatmap.getArtist(true)} - ${tempBeatmap.getTitle(true)}`;
                this.#playingNowBeatmapIndex = tempBeatmap.index;
            }

            findBeatmapByIndex(index){
                let r;
                for (let i = 0; i < this.#beatmapArray.length; i++) {
                    let b = this.#beatmapArray[i];
                    if(b.index == index){
                        r = b; break;
                        console.log("in");
                    }
                }
                return r;
            }

            getBeatmapPlayingNow(){
                return this.findBeatmapByIndex(this.#playingNowBeatmapIndex);
            }
            
            setVolume(){
                this.#audioElement.volume = this.#masterVolume.value*this.#musicVolume.value;
                this.#hitNormal.changeVolume(this.#effectsVolume.value*this.#masterVolume.value);
                this.#hitClap.changeVolume(this.#effectsVolume.value*this.#masterVolume.value);
            }



            // GAMEPLAY
            pauseGameplay(){
                this.#isGameplayPaused = true;
            }
            resumeGameplay(){
                this.#isGameplayPaused = false;
            }

            // MAIN SCREEN / MENU
            goToMainScreen(){
                console.log("goToMainScreen()");
                this.disableAllScreens();
                document.getElementById("main-screen").classList.remove("disabled");
                this.#isMainScreen = true;
            }
            goToBeatmapSelect(){
                console.log("goToBeatmapSelect()");

            }
            goToResultsScreen(){
                console.log("goToResultsScreen()");

            }
            openMenu(){
                if(this.#isMenuOpen) return;
                if(!this.#isBackButtonEnabled){
                    this.#backButtonElement1.classList.remove("back-button-disabled");
                    this.#isBackButtonEnabled = true;
                }
                console.log("open menu");
                this.#isMenuOpen = true;
                this.#menuElement.style.left = "0";
                this.#menuElement.style.opacity = "1";
            }
            closeMenu(){
                if(!this.#isMenuOpen) return;
                if(this.#isBackButtonEnabled){
                    this.#backButtonElement1.classList.add("back-button-disabled");
                    this.#isBackButtonEnabled = false;
                }
                console.log("close menu");
                this.saveSettings();
                this.#isMenuOpen = false;
                this.#menuElement.style.left = "-50%";
                this.#menuElement.style.opacity = "0";
            }
            exitGame(){
                alert("there is no such for the web version!");
            }

            disableAllScreens(){
                document.getElementById("main-screen").classList.add("disabled");
                document.getElementById("beatmap-select").classList.add("disabled");
                document.getElementById("playfield").classList.add("disabled");
                document.getElementById("results-screen").classList.add("disabled");
            }
            


            // MUSIC PLAYER
            playSong(){
                if(this.#audioElement.paused) {
                    this.#audioElement.play();
                }
                else {
                    this.#audioElement.currentTime = 0;
                }
            }
            playSongFromPreview(){
                this.#audioElement.pause();
                this.#audioElement.currentTime = this.getBeatmapPlayingNow().previewTime/1000;
                this.#audioElement.play();
            }
            pauseSong(){
                if(!this.#audioElement.paused) this.#audioElement.pause();
            }
            stopSong(){
                this.#audioElement.pause();
                this.#audioElement.currentTime = 0;
            }
            playNextSong(){ this.playNextOrPreviousSong(true); }
            playPreviousSong(){ this.playNextOrPreviousSong(false); }
            playNextOrPreviousSong(isNextSong){
                let indexAdder, nextSongIndex;
                let borderCheck, borderJump;

                if(isNextSong){
                    indexAdder = 1;
                    borderCheck = this.#beatmapPlaylist.length-1;
                    borderJump = 0;
                } else {
                    indexAdder = -1;
                    borderCheck = 0;
                    borderJump = this.#beatmapPlaylist.length-1;
                }
                
                for (let i = 0; i < this.#beatmapPlaylist.length; i++) {
                    const tempBeatmap = this.#beatmapPlaylist[i];
                    if(tempBeatmap.index == this.#playingNowBeatmapIndex){
                        if(tempBeatmap.index == borderCheck){
                            nextSongIndex = borderJump;
                        } else nextSongIndex = tempBeatmap.index+indexAdder;
                        break;
                    }
                }

                this.setBeatmap(nextSongIndex);
                this.playSong();
            }

            changeUsername(){
                this.#username.setValue(document.getElementById("username-input").value);
                document.getElementById("username-label").innerHTML = this.#username.value;
            }

            changeMasterVolume(){
                this.#masterVolume.setValue(document.getElementById("master-volume").value/100);
                this.setVolume();
            }
            changeMusicVolume(){
                this.#musicVolume.setValue(document.getElementById("music-volume").value/100);
                this.setVolume();
            }
            changeEffectsVolume(){
                this.#effectsVolume.setValue(document.getElementById("effects-volume").value/100);
                this.setVolume();
            }
        }

        // GAME SETTING CLASS
        class GameSetting{
            #key;
            value;

            constructor(keyString){
                this.#key = keyString;
                this.value = this.getValueFromLocalStorage();
            }

            setValue(v){
                this.value = v;
                this.saveValue();
            }

            saveValue(){
                localStorage.setItem(this.#key, this.value);
            }

            getValueFromLocalStorage(){
                let r = localStorage.getItem(this.#key);
                if(r) return r;
                let k = this.#key;

                let arr = [
                    // GAMEPLAY
                    ["username", "PLAYER1"],
                    ["globalOffsetPx", 0],
                    ["globalNoteOffsetMs", 290],
                    ["globalHitOffsetMs", 500],
                    ["targetFps", 1000],
                    // AUDIO
                    ["masterVolume", 0.02],
                    ["musicVolume", 1],
                    ["effectsVolume", 1],
                    // LANGUAGE
                    ["useUnicode", false],
                ];

                let i = 0;
                while(i < arr.length){
                    if(k == arr[i][0]){
                        r = arr[i][1];
                        return r;
                    }
                    i++;
                }
            }
        }

        // MAP SETUP FUNCTIONS
        function setNotesArrayStreamMaker(){
            bpm = 240;

            let bpms = (60/bpm)*1000;
            let minSV = 0.75;
            let maxSV = 1.2;
            let tempIsDon = false;
            let baseColor = "katsu";
            let patternSize = 3;
            let noteCount = 100;

            let tempSV = 0;
            for (let i = 0; i < noteCount; i++) {
                tempSV = (i/noteCount)*(maxSV-minSV)+minSV;
                tempIsDon = (i%patternSize == 0);
                if(baseColor != "don") tempIsDon = !tempIsDon;
                notesArray.push(new Note( tempSV, tempIsDon, 1000+i*(bpms)/4 ));
            }
        }

        function setNotesArrayStreamRandom(){
            bpm = 150;

            let bpms = (60/bpm)*1000;
            let minSV = 1;
            let maxSV = 1;
            let ittSV = 1;
            let ittSVIncreasing = true;
            let counterSV = 32;
            let tempIsDon = false;
            let patternSize = 3;
            let noteCount = 1000;
            let maxRepeatableColor = 4;
            let tempRepeatableColor = 0;

            let tempSV = 0;
            for (let i = 0; i < noteCount; i++) {
                if(tempRepeatableColor <= 0){
                    tempIsDon = !tempIsDon
                    tempRepeatableColor = Math.ceil(Math.random()*(maxRepeatableColor));
                }

                tempRepeatableColor--;

                if(ittSV >= counterSV || ittSV <= 0){ ittSVIncreasing = !ittSVIncreasing; }
                if(ittSVIncreasing){ ittSV++; } else { ittSV--; }
                tempSV = myBezierSimple(ittSV/counterSV)*(maxSV-minSV)+minSV;
                notesArray.push(new Note( tempSV, tempIsDon? 0 : 1, 1000+i*(bpms)/4 ));
            }
        }

        function myBezierOld(t) {
            // returns a custom bezier (0 to 1) for t value (0 to 1)
            // based on:  https://javascript.info/bezier-curve
            let x, y;
            let x1, x2, x3, x4;
            let y1, y2, y3, y4;
            
            x1 = y1 = 1;
            x4 = y4 = 1;

            x2 = 0.5; y2 = 1;
            x3 = 0.5; y3 = 1;

            x = Math.pow(1-t, 3)*x1 + 3*(1-t, 2)*t*x2 + 3*(1-t)*Math.pow(t,2)*x3 + Math.pow(t, 3)*x4;
            y = Math.pow(1-t, 3)*y1 + 3*(1-t, 2)*t*y2 + 3*(1-t)*Math.pow(t,2)*y3 + Math.pow(t, 3)*y4;
            
            let r = Math.pow(1-t, 3)*t + 3*(1-t, 2)*t*t + 3*(1-t)*Math.pow(t,2)*t + Math.pow(t, 3)*t;
            
            return r;
        }

        function myBezierSimple(t) {
            // based on: http://www.demofox.org/bezcubic1d.html
            // source: https://blog.demofox.org/2014/08/28/one-dimensional-bezier-curves/
            return 3*Math.pow(t,2)*(1-t) + Math.pow(t,3);
        }

        function setAfroKnucleMap() {
            // map properties
            //song = new Audio(base64database.song2);
            od = 6;
            bpm = 145;

            // hit objects
            notesArray = [];
            let sv;
            sv = 1.05;
            notesArray.push(new Note(sv, 0, 554));
            notesArray.push(new Note(sv, 1, 760));
            notesArray.push(new Note(sv, 0, 864));
            notesArray.push(new Note(sv, 1, 1381));
            notesArray.push(new Note(sv, 0, 1588));
            notesArray.push(new Note(sv, 1, 1691));
            notesArray.push(new Note(sv, 0, 1795));
            notesArray.push(new Note(sv, 0, 2002));
            notesArray.push(new Note(sv, 1, 2209));
            notesArray.push(new Note(sv, 0, 2347));
            notesArray.push(new Note(sv, 1, 2485));
            notesArray.push(new Note(sv, 0, 2622));
            notesArray.push(new Note(sv, 0, 2829));
            notesArray.push(new Note(sv, 1, 3036));
            notesArray.push(new Note(sv, 0, 3174));
            notesArray.push(new Note(sv, 1, 3243));
            notesArray.push(new Note(sv, 0, 3312));
            notesArray.push(new Note(sv, 0, 3381));
            notesArray.push(new Note(sv, 1, 3450));
            notesArray.push(new Note(sv, 0, 3554));
            notesArray.push(new Note(sv, 1, 3657));
            sv = 1.1;
            notesArray.push(new Note(sv, 0, 3864));
            notesArray.push(new Note(sv, 1, 4071));
            notesArray.push(new Note(sv, 1, 4174));
            notesArray.push(new Note(sv, 0, 4691));
            notesArray.push(new Note(sv, 1, 4898));
            notesArray.push(new Note(sv, 1, 5002));
            notesArray.push(new Note(sv, 0, 5105));
            notesArray.push(new Note(sv, 0, 5209));
            notesArray.push(new Note(sv, 1, 5312));
            notesArray.push(new Note(sv, 0, 5416));
            notesArray.push(new Note(sv, 1, 5519));
            notesArray.push(new Note(sv, 0, 5657));
            notesArray.push(new Note(sv, 0, 5726));
            sv = 1.09;
            notesArray.push(new Note(sv, 0, 5795));
            sv = 1.08;
            notesArray.push(new Note(sv, 1, 5933));
            sv = 1.07;
            notesArray.push(new Note(sv, 0, 6071));
            sv = 1.06;
            notesArray.push(new Note(sv, 1, 6209));
            sv = 1.05;
            notesArray.push(new Note(sv, 0, 6347));
            sv = 1.04;
            notesArray.push(new Note(sv, 0, 6450));
            sv = 1.03;
            notesArray.push(new Note(sv, 1, 6554));
            sv = 1.02;
            notesArray.push(new Note(sv, 1, 6657));
            sv = 1.01;
            notesArray.push(new Note(sv, 0, 6760));
            notesArray.push(new Note(sv, 0, 6967));
            sv = 1;
            notesArray.push(new Note(sv, 1, 7174));
            notesArray.push(new Note(sv, 0, 7381));
            notesArray.push(new Note(sv, 0, 7485));
            notesArray.push(new Note(sv, 1, 7588));
            notesArray.push(new Note(sv, 1, 7795));
            notesArray.push(new Note(sv, 0, 7898));
            notesArray.push(new Note(sv, 1, 8002));
            notesArray.push(new Note(sv, 1, 8209));
            notesArray.push(new Note(sv, 0, 8312));
            notesArray.push(new Note(sv, 0, 8416));
            notesArray.push(new Note(sv, 1, 8519));
            notesArray.push(new Note(sv, 0, 8622));
            notesArray.push(new Note(sv, 1, 8726));
            notesArray.push(new Note(sv, 0, 8829));
            notesArray.push(new Note(sv, 1, 9036));
            notesArray.push(new Note(sv, 0, 9140));
            notesArray.push(new Note(sv, 0, 9243));
            notesArray.push(new Note(sv, 1, 9450));
            notesArray.push(new Note(sv, 1, 9554));
            notesArray.push(new Note(sv, 0, 9657));
            notesArray.push(new Note(sv, 1, 9864));
            notesArray.push(new Note(sv, 0, 9967));
            notesArray.push(new Note(sv, 1, 10071));
            notesArray.push(new Note(sv, 1, 10174));
            notesArray.push(new Note(sv, 0, 10278));
            notesArray.push(new Note(sv, 1, 10381));
            notesArray.push(new Note(sv, 0, 10485));
            notesArray.push(new Note(sv, 1, 10691));
            notesArray.push(new Note(sv, 0, 10795));
            notesArray.push(new Note(sv, 1, 10898));
            notesArray.push(new Note(sv, 1, 11105));
            notesArray.push(new Note(sv, 1, 11209));
            notesArray.push(new Note(sv, 0, 11312));
            notesArray.push(new Note(sv, 0, 11519));
            notesArray.push(new Note(sv, 0, 11622));
            notesArray.push(new Note(sv, 1, 11726));
            notesArray.push(new Note(sv, 1, 11829));
            notesArray.push(new Note(sv, 1, 12036));
            notesArray.push(new Note(sv, 0, 12140));
            notesArray.push(new Note(sv, 1, 12347));
            notesArray.push(new Note(sv, 0, 12450));
            notesArray.push(new Note(sv, 1, 12554));
            notesArray.push(new Note(sv, 1, 12760));
            notesArray.push(new Note(sv, 1, 12829));
            notesArray.push(new Note(sv, 1, 12898));
            notesArray.push(new Note(sv, 0, 12967));
            notesArray.push(new Note(sv, 0, 13174));
            notesArray.push(new Note(sv, 1, 13278));
            notesArray.push(new Note(sv, 0, 13381));
            notesArray.push(new Note(sv, 0, 13588));
            notesArray.push(new Note(sv, 1, 13795));
            notesArray.push(new Note(sv, 1, 14002));
            notesArray.push(new Note(sv, 0, 14105));
            notesArray.push(new Note(sv, 1, 14209));
            notesArray.push(new Note(sv, 1, 14416));
            notesArray.push(new Note(sv, 0, 14519));
            notesArray.push(new Note(sv, 0, 14622));
            notesArray.push(new Note(sv, 1, 14829));
            notesArray.push(new Note(sv, 0, 14933));
            notesArray.push(new Note(sv, 1, 15036));
            notesArray.push(new Note(sv, 1, 15243));
            notesArray.push(new Note(sv, 0, 15347));
            notesArray.push(new Note(sv, 0, 15450));
            notesArray.push(new Note(sv, 1, 15657));
            notesArray.push(new Note(sv, 1, 15760));
            notesArray.push(new Note(sv, 0, 15864));
            notesArray.push(new Note(sv, 1, 16071));
            notesArray.push(new Note(sv, 0, 16174));
            notesArray.push(new Note(sv, 0, 16278));
            notesArray.push(new Note(sv, 0, 16381));
            notesArray.push(new Note(sv, 1, 16485));
            notesArray.push(new Note(sv, 0, 16588));
            notesArray.push(new Note(sv, 1, 16691));
            notesArray.push(new Note(sv, 1, 16795));
            notesArray.push(new Note(sv, 0, 16898));
            notesArray.push(new Note(sv, 0, 17002));
            notesArray.push(new Note(sv, 1, 17105));
            notesArray.push(new Note(sv, 1, 17209));
            notesArray.push(new Note(sv, 0, 17312));
            notesArray.push(new Note(sv, 0, 17416));
            notesArray.push(new Note(sv, 1, 17519));
            notesArray.push(new Note(sv, 1, 17622));
            notesArray.push(new Note(sv, 0, 17726));
            notesArray.push(new Note(sv, 0, 17829));
            notesArray.push(new Note(sv, 1, 17933));
            notesArray.push(new Note(sv, 1, 18036));
            notesArray.push(new Note(sv, 0, 18140));
            notesArray.push(new Note(sv, 1, 18243));
            notesArray.push(new Note(sv, 0, 18347));
            notesArray.push(new Note(sv, 0, 18450));
            notesArray.push(new Note(sv, 1, 18554));
            notesArray.push(new Note(sv, 1, 18622));
            notesArray.push(new Note(sv, 1, 18691));
            notesArray.push(new Note(sv, 0, 18760));
            notesArray.push(new Note(sv, 0, 18967));
            notesArray.push(new Note(sv, 0, 19036));
            notesArray.push(new Note(sv, 0, 19105));
            notesArray.push(new Note(sv, 1, 19174));
            notesArray.push(new Note(sv, 0, 19381));
            notesArray.push(new Note(sv, 1, 19588));
            notesArray.push(new Note(sv, 1, 20002));
            notesArray.push(new Note(sv, 0, 20416));
            notesArray.push(new Note(sv, 1, 20622));
            notesArray.push(new Note(sv, 1, 20726));
            notesArray.push(new Note(sv, 0, 20829));
            notesArray.push(new Note(sv, 1, 21036));
            notesArray.push(new Note(sv, 0, 21140));
            notesArray.push(new Note(sv, 0, 21243));
            notesArray.push(new Note(sv, 1, 21347));
            notesArray.push(new Note(sv, 1, 21554));
            notesArray.push(new Note(sv, 0, 21657));
            notesArray.push(new Note(sv, 1, 21760));
            notesArray.push(new Note(sv, 1, 21967));
            notesArray.push(new Note(sv, 0, 22071));
            notesArray.push(new Note(sv, 1, 22278));
            notesArray.push(new Note(sv, 1, 22381));
            notesArray.push(new Note(sv, 0, 22485));
            notesArray.push(new Note(sv, 1, 22691));
            notesArray.push(new Note(sv, 0, 22898));
            notesArray.push(new Note(sv, 1, 23002));
            notesArray.push(new Note(sv, 1, 23209));
            notesArray.push(new Note(sv, 0, 23312));
            notesArray.push(new Note(sv, 1, 23416));
            notesArray.push(new Note(sv, 1, 23622));
            notesArray.push(new Note(sv, 0, 23726));
            notesArray.push(new Note(sv, 0, 23829));
            notesArray.push(new Note(sv, 1, 23933));
            notesArray.push(new Note(sv, 0, 24036));
            notesArray.push(new Note(sv, 1, 24140));
            notesArray.push(new Note(sv, 1, 24347));
            notesArray.push(new Note(sv, 1, 24450));
            notesArray.push(new Note(sv, 0, 24554));
            notesArray.push(new Note(sv, 1, 24657));
            notesArray.push(new Note(sv, 1, 24864));
            notesArray.push(new Note(sv, 0, 24967));
            notesArray.push(new Note(sv, 1, 25071));
            notesArray.push(new Note(sv, 1, 25278));
            notesArray.push(new Note(sv, 0, 25381));
            notesArray.push(new Note(sv, 1, 25588));
            notesArray.push(new Note(sv, 0, 25795));
            notesArray.push(new Note(sv, 1, 25898));
            notesArray.push(new Note(sv, 1, 26002));
            notesArray.push(new Note(sv, 1, 26105));
            notesArray.push(new Note(sv, 0, 26209));
            notesArray.push(new Note(sv, 0, 26312));
            notesArray.push(new Note(sv, 1, 26416));
            notesArray.push(new Note(sv, 1, 26519));
            notesArray.push(new Note(sv, 0, 26622));
            notesArray.push(new Note(sv, 1, 26726));
            notesArray.push(new Note(sv, 1, 26829));
            notesArray.push(new Note(sv, 1, 26933));
            notesArray.push(new Note(sv, 0, 27036));
            notesArray.push(new Note(sv, 0, 27243));
            notesArray.push(new Note(sv, 1, 27450));
        }

        function loadMap() {
            notesArray = [];
            
            bpm = 145;
            
            let noteStringArray = document.getElementById("mapText").value.split('\n');
            
            let tempSV = 1;

            noteStringArray.forEach(noteString => {
                let holder = noteString.split(',');
                let tempType = holder[4];
                let tempOffset = holder[2];
                notesArray.push(new Note(tempSV, holder[4], holder[2]));
            });
        }


        
        function convertMap() {
            let noteStringArray = document.getElementById("mapText").value.split('\n');
            let tempArray = [];

            let tempSV = 1;

            noteStringArray.forEach(noteString => {
                let holder = noteString.split(',');
                let tempType = holder[4];
                let tempOffset = holder[2];
                tempArray.push(new Note(tempSV, holder[4], holder[2]));
            });
            
            console.log(tempArray);
        }



        async function load() {
            

        }
        
        let gc = new GameController();
        load();
    </script>
</body>
</html>